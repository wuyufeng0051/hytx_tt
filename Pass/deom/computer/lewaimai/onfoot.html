<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
      <script type="text/javascript" src="js/jquery.js"></script>
    <title>乐外卖 - 财务统计</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/chosen.min.css" />
    <link rel="stylesheet" href="css/ace-fonts.min.css" />
    <link rel="stylesheet" href="css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />
    <script src="js/jquery-migrate-1.1.0.min.js"></script>
  </head>
  <body class="no-skin">
<div class="main-content">
  <div class="breadcrumbs" id="breadcrumbs">
    <ul class="breadcrumb">
      <li>
        <i class="ace-icon fa fa-bicycle"></i>
        <a href="#">跑腿</a></li>
      <li class="active">跑腿订单</li></ul>
    <!-- .breadcrumb --></div>
  <div class="page-content">
    <!-- /section:settings.box -->
    <div class="page-content-area">
      <div class="row">
        <div class="col-xs-12">
          <div class="tabbable">
            <ul class="nav nav-tabs" id="myTab">
              <li class="active">
                <a href="onfoot.html">待抢订单</a></li>
              <li>
                <a href="onfoot_down.html">已抢订单</a></li>
              <li>
                <a href="onfoot_succeed.html">成功订单</a></li>
              <li>
                <a href="onfoot_fail.html">失败订单</a></li>
              <li>
                <a href="onfoot_cancel.html">取消订单</a></li>
            </ul>
            <div class="tab-content">
              <a id="add-order" class="btn btn-warning" href="onfoot_new.html">新建订单</a>
              <button class="btn btn-danger" onclick="FailedReason()">失败订单</button>
              <div style="float:right;margin-bottom:15px;">
                <div class="chosen-container chosen-container-single" style="width: 84px;" title="" id="courier_id_chosen">
                  <a class="chosen-single" tabindex="-1">
                    <span>请选择</span>
                    <div>
                      <b>
                      </b>
                    </div>
                  </a>
                  <div class="chosen-drop">
                    <div class="chosen-search">
                      <input type="text" autocomplete="off"></div>
                    <ul class="chosen-results">
                      <li class="active-result result-selected" data-option-array-index="0">请选择</li>
                      <li class="active-result" >韦志强</li>
                      <li class="active-result" >望开虎</li>
                      <li class="active-result" >向俊</li>
                      <li class="active-result" >汰渍洗衣</li>
                      <li class="active-result" >梅虎</li>
                      <li class="active-result" >杜威</li>
                      <li class="active-result" >张青松</li>
                      <li class="active-result" >徐林</li>
                      <li class="active-result" >向俊杰1</li>
                      <li class="active-result" >傅德生</li>
                      <li class="active-result" >张其叁</li>
                      <li class="active-result" >王强</li>
                      <li class="active-result" >杨兰贵</li>
                      <li class="active-result" >黎晓宜</li>
                      <li class="active-result" >黄烁</li>
                    </ul>
                  </div>
                </div>
                <a onclick="setCourier();" class="btn no-border btn-success">设置配送员</a></div>
              <!-- <div>
              <button class="btn btn-danger" onclick="FailedReason()">取消订单</button></div> -->
              <div id="customerList" class="grid-view">
                <table class="table table-striped table-bordered table-hover">
                  <thead>
                    <tr>
                      <th class="checkbox-column" id="customerList_c0">
                        <input type="checkbox" value="1" name="customerList_c0_all" id="customerList_c0_all"></th>
                      <th id="customerList_c1">
                        <a class="sort-link" href="#">订单编号</a></th>
                      <th id="customerList_c2">服务类型</th>
                      <th id="customerList_c3">服务内容</th>
                      <th id="customerList_c4">
                        <a class="sort-link" href="#">姓名</a></th>
                      <th id="customerList_c5">
                        <a class="sort-link" href="#">电话</a></th>
                      <th id="customerList_c6">
                        <a class="sort-link" href="#">地址</a></th>
                      <th id="customerList_c7">
                        <a class="sort-link" href="#">跑腿费</a></th>
                      <th id="customerList_c8">
                        <a class="sort-link" href="#">总金额</a></th>
                      <th id="customerList_c9">支付方式</th>
                      <th id="customerList_c10">
                        <a class="sort-link desc" href="#">下单时间</a></th>
                    </tr>
                    <tr class="filters">
                      <td>&nbsp;</td>
                      <td>
                        <input name="ErrandOrder[trade_no]" type="text"></td>
                      <td>&nbsp;</td>
                      <td>&nbsp;</td>
                      <td>
                        <input name="ErrandOrder[name]" type="text" maxlength="10"></td>
                      <td>
                        <input name="ErrandOrder[phone]" type="text" maxlength="20"></td>
                      <td>
                        <input name="ErrandOrder[address]" type="text" maxlength="200"></td>
                      <td>
                        <input name="ErrandOrder[delivery_fee]" type="text" maxlength="10"></td>
                      <td>
                        <input name="ErrandOrder[totalprice]" type="text"></td>
                      <td>&nbsp;</td>
                      <td>
                        <input name="ErrandOrder[init_time]" type="text"></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="odd">
                      <td width="30">
                        <input value="155817" id="customerList_c0_0" type="checkbox" name="selectorderlist[]"></td>
                      <td width="80">2017031648100541</td>
                      <td width="80">火鸟测试</td>
                      <td width="150">
                        <div>配送位置：b</div>
                        <div>配送位置：a</div></td>
                      <td width="80">zzx</td>
                      <td width="80">15103459999</td>
                      <td width="80">在小吃着吃着</td>
                      <td width="80">1.00</td>
                      <td width="80">1.00</td>
                      <td width="80">
                        <b style="color:red">货到付款</b></td>
                      <td width="80">2017-03-16 17:32:32</td></tr>
                  </tbody>
                </table>
                <div class="summary">第 1-1 条, 共 1 条.</div>
                <div class="keys" style="display:none" title="/errands/orderdaiqiang">
                  <span>155817</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="modal-reason" class="modal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" id="modal-close-trigger" class="close" data-dismiss="modal" onclick="$('#modal-reason').hide()">×</button>
              <h4 class="blue bigger">请填写订单失败的原因</h4></div>
            <div class="modal-body">
              <div class="row">
                <div class="col-xs-12 col-sm-12">
                  <textarea id="order_failed_reason" style="width:100%;"></textarea>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-sm" onclick="$('#modal-reason').hide()">
                <i class="ace-icon fa fa-times"></i>取消</button>
              <button class="btn btn-sm btn-primary" onclick="GetFailedCheckbox()">
                <i class="ace-icon fa fa-check"></i>确定</button>
            </div>
          </div>
        </div>
      </div>
      <script>var submittage = 'no';

        $(function() {
          /*新建订单*/
          $("#add-order").on("click",
          function(e) {
            window.location.href = "/errands/createorder";
          });
        });
        function setCourier() {
          var data = new Array();
          jQuery("input[name='selectorderlist\[\]']:enabled").each(function() {
            if (this.checked == true) {
              data.push(this.value);
            }
          });
          if (data.length > 0) {
            bootbox.confirm("确认设置配送员?",
            function(result) {
              if (result == true) {
                jQuery.post("/errands/setCourier", {
                  'selectaddblacklist[]': data,
                  'courier_id': jQuery("#courier_id").val()
                },
                function(result) {

                  if (result != null && result.success != null && result.success) {
                    window.location.href = "/errands/orderdaiqiang";
                  } else {
                    bootbox.alert(result.errmsg);
                  }
                },
                'json');
              } else {
                submittage = 'no';
              }
            });
          } else {
            bootbox.alert("请选择要设置配送员的订单!");
          }
        }

        function FailedReason() {
          var data = new Array();
          $("input[name='selectorderlist\[\]']:checked").each(function() {
            data.push(this.value);
          });

          if (data.length > 0) {
            console.log(data);

            $('#modal-reason').show();
          } else {
            bootbox.alert('请选择要取消订单的选项!');
            return;
          }
        }

        function GetFailedCheckbox() {
          var reason = $('#order_failed_reason').val();
          if (!reason) {
            bootbox.alert("请输入订单失败的原因");
            return;
          }
          if (submittage == 'yes') {
            return;
          } else {
            submittage = 'yes';
          }
          var data = new Array();
          jQuery("input[name='selectorderlist\[\]']:enabled").each(function() {
            if (this.checked == true) {
              data.push(this.value);
            }
          });
          if (data.length > 0) {
            bootbox.confirm("确认设置这些订单为失败状态??",
            function(result) {
              if (result == true) {
                jQuery.post("/errands/batch_add_failed_order", {
                  'selectorderlist[]': data,
                  'reason': reason
                },
                function(data) {
                  var ret = jQuery.parseJSON(data);
                  if (ret != null && ret.status == 'success') {
                    bootbox.alert(ret.message);
                    window.location.href = "/errands/orderdaiqiang";
                  } else if (ret != null && ret.status == 'error') {

                    bootbox.alert(ret.message);
                    submittage = 'no';
                  } else {
                    bootbox.alert('设置失败，请稍后再设置或');
                    submittage = 'no';
                  }
                });
              } else {
                submittage = 'no';
              }
            });
          } else {
            bootbox.alert("请选择要设为订单的选项!");
            submittage = 'no';
          }
        }</script>
    </div>
    <!-- /.page-content-area --></div>
  <!-- /.page-content --></div>
<div class="disk"></div>
<script type="text/javascript" src="js/public_select.js"></script>
  </body>
</html>