<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>绑定手机</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no" >
	<link rel="stylesheet" href="__PUBLIC__/Home/css/base.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/mui.min.css">
	<script type="text/javascript" src="__PUBLIC__/Home/js/touchScale.js"></script>

	<style>
	/*公用头部*/
	.header{
	    height: .9rem;
	    background: #fd5530 !important;
	    color: #fff;
	    font-size: .32rem;
	    line-height: .9rem;
	    max-width: 1080px;
	    position: fixed;
	    top: 0;
	    left: 0;
	    right: 0;
	    z-index: 10;
	    overflow: hidden;
	}
	.header a{
		display: inline-block;
		color: #fff;
	}
	.header .back{
	    height: .9rem;
	    line-height: .9rem;
	    width: 17%;
	    float: left;
	}
	.header .back i{
	    width: 0.4rem;
	    height: .9rem;
	    display: inline-block;
	    background: url(__PUBLIC__/Home/img/back.png) no-repeat 4px 10px;
	    vertical-align: middle;
	    background-size: .3rem;
	}
	.header .header_right{
		float: right;
		height: .9rem;
		margin-right: .2rem;
	}
	.header .header_right i{
	    width: 0.04rem;
	    height: 0.5rem;
	    display: inline-block;
	    vertical-align: middle;
	    background: #fff;
	    margin: 0 .15rem;
	}
	.header .title_1{
	    float: left;
	    width: 70%;
	    text-align: center;
	    font-size: 0.38rem;
	}
	.header .share{
	    height: .9rem;
	    float: right;
	    width: 12%;
	    background: url(__PUBLIC__/Home/img/pb_11.png) no-repeat center;
	    background-size: .5rem;
	}
	body{
		background-color: #fff;
	}
		.input{
			margin-top: 20px;
			background:#fff;
		}
		.input input{
			margin-bottom: 0;
			border-right: 0;
			border-left: 0;
			border-radius: 0;
		}
		.btn{
			margin-top: 50px;
			line-height: 44px;
			padding: 10px;
		}
		.btn button{
			width: 100%;
			background: #fd5530;
			color: #fff;
			line-height: 40px;
			height: 40px;
			padding: 0;
			border:none;
		}
		.vcode{
			/*margin-top: 10px;*/
			position: relative;
		}
		.vcode input{
			margin-bottom: 0;
			border-right: 0;
			border-left: 0;
			border-radius: 0;
			padding-right: 85px;
		}
		.vcode span{
			position: absolute;
			top:15px;
			right: 15px;
			font-size: 14px;
			background-color: #DEF1D3;
			color: #8ee064;
			padding: 5px 8px;
		}
		.input .tel{
			border-top: none;
			border-bottom: none;
		}
		.input .number{
			border-bottom: 1px solid #ddd;
		}
	</style>
</head>
<body>
<!-- 共同顶部 s-->
		<div class="header fn-clear">
			<div class="back"><a href="javascript:history.go(-1)"><i></i>返回</a></div>
			<div class="title_1">绑定手机</div>
		</div>
	<!-- 共同顶部 e-->
<include file="Public/share" title='包含文件'/>
	<div class="input" style="margin-top: 1.2rem;">
		<input class="tel" placeholder="请输入手机号" type="tel" value="{$phone}">	 
	</div>
	<div class="vcode" style="height: 60px;line-height: 60px;border: 1px solid rgba(0,0,0,.2);">
		<input class="number" type="number"  placeholder="请输入短信验证码" style="height: 20px;line-height: 20px;border: none;padding: 0 15px;"><span style="height: 30px;line-height: 20px;" id="codeBtn">获取验证码</span><span style="display:none;height: 30px;line-height: 20px;" id="hidden"></span>
	</div>
	</div>
	<div class="btn">
		<button class="">保存</button>
</body>

<script src="__PUBLIC__/Home/js/jquery.min.js"></script>
<script src="__PUBLIC__/Home/js/layer.js"></script>
<script>



	//点击发送验证码
	var preg = /^1[34578]\d{9}$/;
	$(function() {
		$('#codeBtn').click(function () {
			var phone = $('.input input').val();
			if (!preg.test(phone)) {
				layer.msg('请输入正确的手机号');
				return;
			}
			$.post('__MODULE__/Index/code', {phone: phone}, function (msg) {
				//alert(msg);
			})
			//时间倒计时
			$('#hidden').text('60s后再发送');
			$('#hidden').show();
			$(this).hide();
			var s1time = 59;
			var time = setInterval(stime, 1000);
			function stime() {
				var s = s1time + 's后再发送';
				$("#hidden").text(s);

				s1time--;
				if (s1time == 0) {
					clearTimeout(time);
					$("#codeBtn").show();
					$("#hidden").hide();
				}

			}

		})
	})

	function req(){
		// location.href='__MODULE__/Index/profile';
		//location= document.referrer
		history.go(-1);
	}

	$(function(){

		$('button').click(function(){
			var phone= $('.input input').val();
			var vcode= $('.vcode input').val();
			if(!preg.test(phone)){
				layer.msg('请输入正确的手机号码');
				return ;
			}else if(vcode==''){
				layer.msg('请填写验证码');
				return ;
			}
			$.post('__MODULE__/EditUser/EditPhone',{user_phone:phone,code:vcode},function(msg){
				if(msg == 1){
					layer.msg('已保存');
					setTimeout('req()',1500);
				}else{
					layer.msg(msg);
				}
			})
		})
	})

</script>
</html>