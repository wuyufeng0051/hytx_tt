<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>求购信息发布</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/base.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/mui.min.css">
	<script type="text/javascript" src="__PUBLIC__/Home/js/touchScale.js"></script>
	<style>
	.title{
		color: #000;
	    padding-left: 15px;
	    line-height: 32px;
	    font-weight: normal;
	    margin: 0;
	    font-size: 16px;
	    background: #f2f2f2;
	}

	.list .item{
		border-bottom: 1px solid #ddd;
	    padding: 10px;
	    background: #fff;
	    position: relative;
	    padding-left: 95px;
	}
	.list .item span{
		color: #fd5530;
		margin-right: 5px;
		position: relative;
		top: 4px;
	}
	.list .item label{
		font-size: 16px;
		position: absolute;
		left: 10px;
	}
	.list .item input{
		border:none;
		padding: 0;
		width: auto;
		margin:0;
		line-height: 21px;
		height: 21px;
		width: 100%;
	}
	.list .item select{
	    width: 100%;
	    padding: 0;
	    margin: 0;
	    font-size: 16px;
	    background: url(__PUBLIC__/Home/img/arrow.png) no-repeat right center;
	    background-size: 16px 16px;
	    height: 21px;
	}
	.list .itemprice select{
		width: 100%;
	    padding: 0;
	    margin: 0;
	    font-size: 16px;
	    background: url(__PUBLIC__/Home/img/arrow.png) no-repeat 50px center;
	    background-size: 16px 16px;
	    height: 21px;
	}
	.checkbox>span{
		padding-left:20px;
		background: url(__PUBLIC__/Home/img/select.png) no-repeat left top;
    	background-size: 16px 16px;
	}
	.checkbox>span.selected{
		background: url(__PUBLIC__/Home/img/selected.png) no-repeat left top;
    	background-size: 16px 16px;
	}

	.my{
		display: inline-block;line-height: 21px;background: url(__PUBLIC__/Home/img/circle.png) left top no-repeat;padding-left: 20px;background-size: 20px 20px;
	}
	.my.select{
		background:url(__PUBLIC__/Home/img/sec.png) left top no-repeat;
		background-size: 20px 20px;
	}
	.ty{
		padding-left: 20px;
		background: url(__PUBLIC__/Home/img/tongyi1.png) no-repeat left center;
		background-size: 16px 16px;
	}
	.ty.select{
		background: url(__PUBLIC__/Home/img/tongyi.png) no-repeat left center;
		background-size: 16px 16px;
	}
	.Desc1{padding: 5px;margin-bottom: 0;border:none;height: 2.8rem;}
	/*公用头部*/
	.header{
	    height: .9rem;
	    background: #fd5530 !important;
	    color: #fff;
	    font-size: .32rem;
	    line-height: .9rem;
	    max-width: 1080px;
	    position: relative;
	    overflow: hidden;
	}
	.header a{
		display: inline-block;
		color: #fff;
	}
	.header .back{
	    height: .9rem;
	    line-height: .9rem;
	    width: 17%;
	    float: left;
	}
	.header .back i{
	    width: 0.4rem;
	    height: .9rem;
	    display: inline-block;
	    background: url(__PUBLIC__/Home/img/back.png) no-repeat 4px 10px;
	    vertical-align: middle;
	    background-size: .3rem;
	}
	.header .header_right{
		float: right;
		height: .9rem;
		margin-right: .2rem;
	}
	.header .header_right i{
	    width: 0.04rem;
	    height: 0.5rem;
	    display: inline-block;
	    vertical-align: middle;
	    background: #fff;
	    margin: 0 .15rem;
	}
	.header .title_1{
	    float: left;
	    width: 63%;
	    text-align: center;
	    font-size: 0.38rem;
	}
	.header .share{
	    height: .9rem;
	    float: right;
	    width: 12%;
	    background: url(__PUBLIC__/Home/img/pb_11.png) no-repeat center;
	    background-size: .5rem;
	}
	.picture_1{
		    /*background: #e6e6e6;*/
		}
		.picture_1 .pic_list{
		    padding: 0 0.4rem;
		}
		.picture_1 ul li{
		    float: left;
		    position: relative;
		    overflow: hidden;
		    box-shadow: 0 1px 10px 1px rgba(0,0,0,.2);
		    margin-top: 0.3rem;
		    margin-bottom: 0.2rem;
		    width: 1.3rem;
		    height: 1.3rem;
		    margin-right: .36rem;
		    background: #fff;
		}
		.picture_1 ul li img{
		    width: 1.3rem;
		    height: 1.3rem;
		}
		.picture_1 .uploadbtn{
		    width: 1.3rem;
		    height: 1.3rem;
		    text-align: center;
		}
		.picture_1 .uploadbtn input{
		    opacity: 0;
		}
		.picture_1 .uploadbtn em{
		    width: .7rem;
		    height: .7rem;
		    display: block;
		    margin: 0.1rem auto;
		    background: url(__PUBLIC__/Home/img/shi.png) no-repeat center;
		    background-size: .7rem;
		}
		.picture_1 .uploadbtn p{
		    color: #bfbfc0;
		}
		.picture_1 .uploadbtn .webuploader-container div{
		    width: 1.3rem;
		    height: 1.3rem;
		}
		.picture_1 .pic_tips{
		    color: #bfbfc0;
		    padding-bottom: 0.2rem;
		}
		.picture_1 .cancel{
		    position: absolute;
		    right: 0;
		    top: 0;
		    width: .3rem;
		    height: .3rem;
		    background: url(__PUBLIC__/Home/img/cha.png) no-repeat center;
		    background-size: .3rem;
		}
		.delete{
		    position: fixed;
		    left: 50%;
		    margin-left: -3rem;
		    top: 25%;
		    z-index: 12;
		    background: url(__PUBLIC__/Home/img/pb_7.png) no-repeat top;
		    width: 6rem;
		    height: 6rem;
		    background-size: 6rem;
		    text-align: center;
		    display: none;
		}
		.delete h1{
		    font-size: .3rem;
		    margin-top: 1.8rem;
		    font-weight: bold;
		    background: #fff;
		    margin-bottom: 0!important;
		}
		.delete h2{
		    font-size: .3rem;
		    padding-top: .1rem;
		    font-weight: bold;
		    background: #fff;
		    padding-bottom: .3rem;
		    border-bottom: 0.04rem solid #e6e6e6;
		    margin: 0!important;
		}
		.de_foot{
		    width: 100%;
		    background: #fff;
		    border-bottom-right-radius:.2em;
			border-bottom-left-radius:.2em;
		}
		.delete .de_btn{
		    width: 80%;
		    margin: 0 auto;
		    padding: .4rem 0
		}
		.delete .de_btn span{
		    background: #fd5530;
		    color: #fff;
		    padding: 0.15rem .8rem;
		    font-size: .28rem;
		    border-radius: 0.1rem;
		}
		.delete .de_btn span.sure{
		    margin-right: .4rem;
		}
		.disk {
		    background: #000;
		    opacity: .3!important;
		    position: fixed;
		    top: 0;
		    left: 0;
		    right: 0;
		    bottom: 0;
		    z-index: 11;
		    display: none;
		}
		.certfy ul li{
		    position: relative;
		}
		.certfy ul li i{
		    position: absolute;
		    right: 0;
		    top: 0;
		    width: .4rem;
		    height: .4rem;
		    background: url(__PUBLIC__/Home/img/cha.png) no-repeat center;
		    background-size: .4rem;
		}
	.succeed_box{
		position: fixed;
		left: 50%;
		margin-left: -3rem;
		top: 25%;
		z-index: 12;
		background: url(__PUBLIC__/Home/images/pb_7.png) no-repeat top;
		width: 6rem;
		height: 6rem;
		background-size: 6rem;
		text-align: center;
		display: none;
	}
	.succeed_box h1{
		font-size: .3rem;
		margin-top: 1.8rem;
		font-weight: bold;
		background: #fff;
		margin-bottom:0px!important;
		line-height: normal;
	}
	.succeed_box h2{
		font-size: .24rem;
		padding-top: .15rem;
		background: #fff;
		padding-bottom: .35rem;
		border-bottom: 0.04rem solid #e6e6e6;
		margin:0!important;
		line-height: normal;
	}
	.succeed_box h3{
		font-size: .24rem;
		padding-top: .1rem;
		background: #fff;
		padding: 0.1rem 0;
		margin: 0;
	}
	.succeed_box h2 em{
		color: #fe8267;
		margin-right: 0;
	}
	.succeed_box p{
		background: #fff;
		border-radius: 0 0 0.2rem 0.2rem;
		padding: 0.35rem 0;
	}
	.succeed_box p span{
		width: 60%;
		height: .75rem;
		color: #fff;
		font-size: 0.28rem;
		border-radius: 0.15rem;
		background: #fd5530;
		line-height: .75rem;
		display: block;
		margin:  0 auto;
	}
	</style>
</head>
<body>
<include file="Public/share" title='包含文件'/>
<form id="form">
	<!-- 共同顶部 s-->
		<div class="header fn-clear">
			<div class="back"><a href="javascript:history.go(-1)"><i></i>返回</a></div>
			<div class="title_1">填写求购信息</div>
		</div>
	<!-- 共同顶部 e-->
	<div class="disk"></div>
	<div class="mui-content">
		<h3 class="title">求购信息</h3>
		<div class="list">
			<div class="item">
				<label for=""><span>*</span>标题</label>
				<!-- <input type="text" placeholder="请填写求购内容" id="wantbuy_title" name="wantbuy_title"> -->
				<textarea type="text" rows="1" placeholder="请填写标题,20个字以内" maxlength="20" name="wantbuy_title" id="wantbuy_title" style="margin-bottom: 0;padding:0;border:none;outline: none;"></textarea>
			</div>
			<div class="item itemprice" id="mianyi">
				<label for=""><span>*</span>期望价格</label>
				<input type="text" style="width:33%;" placeholder="填写数字" name="wantbuy_price" id="wantbuy_price" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')" onafterpaste="this.value=this.value.replace(/[^\d.]/g,'')">
				<select name="wantbuy_priceunit"  style="width:65px;">
				  <option value="元以内">元以内</option>
				  <option value="万以内">万以内</option>
				</select>
				<div class="my">面议</div>
			</div>
			
			<div class="item" id="Desc1">
				<label for="" style="top: 0;"><span>*</span>求购要求</label>
				<!-- <input type="text" placeholder="请填写物品描述" id="wantbuy_desc" name="wantbuy_desc"> -->
				<textarea type="text" rows="3" class="Desc1" placeholder="请填写物品描述" name="wantbuy_desc" id="wantbuy_desc"></textarea>
			</div>
		</div>
		<h3 class="title">联系人信息</h3>
		<div class="list">
			<div class="item checkbox">
				<label for=""><span>*</span>买家性质</label>
				<span style="position: static;color: #666;margin-right: 10px;" class="selected">个人</span>
				<span style="position: static;color: #666;margin-right: 10px;">商家</span>
				<input type="hidden" id="hide" name="wantbuy_nature" value="0">
			</div>
			<div class="item">
				<label for=""><span>*</span>联系人</label>
				<input type="text" placeholder="请填写联系人" name="wantbuy_name" id="wantbuy_name">
			</div>
			<?php if(!empty($u_res['user_phone'])){ ?>
			<div class="item" style="padding-left: 95px;padding-right: 85px;">
				<label for=""><span>*</span>手机号码</label>
				<input type="text" placeholder="请填写手机号" id="wantbuy_phone" disabled="disabled" value="{$u_res.user_phone}">
				<input type="hidden" id="wantbuy_phones" name="wantbuy_phone">
				<span style="position: absolute;right: 10px;top:9px;font-size: 12px;border:1px solid #fd5530;padding:0 4px;border-radius: 3px;" class="phonechange">更换手机号码</span>
			    <span style="position: absolute;right: 10px;top:9px;font-size: 12px;border:1px solid #fd5530;padding:0 4px;border-radius: 3px;color: #fd5530;display:none" class="emailsell">发送验证码</span>
				<span style="position: absolute;right: 10px;top:9px;font-size: 12px;border:1px solid #919191;padding:0 4px;border-radius: 3px;display:none;color:#919191" class="hidden_button"></span>
			</div>
 
			<div class="item" id="yzm" style="display:none;">
				<label for=""><span>*</span>验证码</label>
				<input type="text" placeholder="请填写验证码" id="code">
			</div>

			<?php }else{ ?>
	           <div class="item">
					<label for=""><span>*</span>手机号码</label>
					<input type="text" placeholder="请输入手机号码" id="wantbuy_phone">
					<input type="hidden" name="wantbuy_phone" id="wantbuy_phones">
	 				<span style="position: absolute;right: 10px;top:9px;font-size: 12px;border:1px solid #fd5530;padding:0 4px;border-radius: 3px;color:#fd5530;" class="emailsell" >发送验证码</span>
					<span style="position: absolute;right: 10px;top:9px;font-size: 12px;border:1px solid #919191;padding:0 4px;border-radius: 3px;display:none;color:#919191" class="hidden_button"></span>
				</div>
				<div class="item" id="yzm">
					<label for=""><span>*</span>验证码</label>
					<input type="text" placeholder="请填写验证码" id="code">
				</div>

	       <?php } ?>
	       
		</div>
		<!-- 申请已提交成功 s -->
		<div class="succeed_box cheng">
			<h1>发布成功</h1>
			<h2>您可以在<em>个人中心-我的发布</em>进行管理</h2>
			<p><a href="javascript:history.go(-1)"><span>确定</span></a></p>
		</div>
		<!-- 申请已提交成功 e -->
		<div style="padding: 30px 15px;text-align: center;" id="tyall">
			<span  style="color:#666;font-size: 13px;">
				<span class="ty select">我已阅读并同意</span><a style="color: #ff7300;" href="__MODULE__/Index/userAgreement">《本地鸟用户协议》</a>
			</span>
			<a class="mui-btn mui-btn-danger btn" style="background-color: #fd5530;line-height: 28px;border:none;width: 100%;margin-top: 10px;" id="buttom">发布</a>
		</div>
	</div>
</form>
	<script src="__PUBLIC__/Home/js/mui.min.js"></script>
	<script src="__PUBLIC__/Home/js/zepto.min.js"></script>
	<script src="__PUBLIC__/Home/js/jquery.min.js"></script>
	<script src="__PUBLIC__/Home/js/layer.js"></script>
	<script src="__PUBLIC__/Home/js/countdown.js"></script>
	<script>
	   $('.cheng p span').click(function(){
	     $('.cheng').hide();
	     $('.disk').hide();
	   })
	  $('.disk').click(function(){
	    $('.cheng').hide();
	    $('.disk').hide();
	    $('.delete').hide();
	  })
	 $(".phonechange").click(function(){
		$(".emailsell").show();
		$("#yzm").show();
		$(".phonechange").hide();
		$("#wantbuy_phone").removeAttr("disabled");
	  })

	$('#buttom').click(function(){
$.post('{:U("Home/Index/userRelease")}', {}, function(data) {
	if (data == 1) {
	 layer.msg('对不起，您没有权利发布信息')
	}else{
	var bianhu = 0;
    var css =  $("#yzm").css('display');
    var wantbuy_price = $('#wantbuy_price').val();//价格
    var select = $('#mianyi').find('.select').text();
    var wantbuy_title = $('#wantbuy_title').val();//标题
    var wantbuy_desc = $('#wantbuy_desc').val();//求购要求
    var wantbuy_name = $('#wantbuy_name').val();//联系人
    var wantbuy_phone = $('#wantbuy_phone').val();//联系人手机号码
    var tyall = $('#tyall').find('.select').text();
      var code = $('#code').val();
	 $.post('{:U("Home/Index/lookcode")}', {}, function(data) {
		   var newcode = data;
      if (!wantbuy_title) {
      	layer.msg('请先输入标题')
      }else if(!select & !wantbuy_price){
		layer.msg('请先输入价格')
      }else if(!wantbuy_desc){
		layer.msg('请先输入求购要求')
      }else if(!wantbuy_name){
		layer.msg('请先输入姓名')
      }else if(!wantbuy_phone){
		layer.msg('请先输入手机号码')
	 }else if(css == 'block'){       
		    if(!code){
		      layer.msg('请先填写验证码')
		    }else if(code != newcode){
			  layer.msg('验证码不正确')
		    }else{
		      bianhu = 1;
		     }
		}else{
		   bianhu = 1;
		}

	   if(bianhu == 1){
	     if(!tyall){
		  layer.msg('请先阅读并同意《本地鸟用户协议》')
         }else{
         	$("#wantbuy_phones").val(wantbuy_phone);

                 $.ajax({ type: 'POST', data: $('#form').serialize(), url: '__MODULE__/SecondHand/addbuy',
                     success: function (data) {
                         if (data.status == 1) {
                             //提交成功弹出层
                             $('.cheng').show();
                             $('.disk').show();
                         }else{
                             alert(data.msg);
                         }
                     },
                     error: function (data) {
                     }
                 });
         }
       }
     })
	 }
     }) 
	})


	    $(function(){
		$('.emailsell').click(function(event) {
			var  myreg = /^1[34578]\d{9}$/;
			var wantbuy_phone=$('#wantbuy_phone').val();
			if(myreg.test(wantbuy_phone)){
				$.post("{:U('Home/Index/code')}",{phone:wantbuy_phone},function(msg){
					//alert(msg)
				})

				var counricount = 179;
				var countdowntime = setInterval(countdownauto, 1000);

				  function countdownauto() {
						counricount--;
						// alert(counricount)
	 				      if(counricount == 0) {
					         $.post("http://www.bdniao.com/index.php/Home/Demo/countdown",{},function(dats){
						     })
	 				      	clearTimeout(time);
	 				   }
					}

				 //时间倒叙
					$(".hidden_button").text(60+'s后发送');
					$(this).hide();
					$(".hidden_button").show();
					var icount = 59;
					var time = setInterval(auto, 1000);

					function auto() {
						var s = icount+'s后再发送';
						$(".hidden_button").text(s);
						icount--;
						if(icount == 0) {
							clearTimeout(time);
							$(".emailsell").show();
							$(".hidden_button").hide();
						}
					}
			}else{
				layer.msg('请先输入正确的手机号码')
			}
		});
		var Desc1 = document.getElementById("Desc1").offsetHeight+"px";
     	$("#Desc1 label").css('line-height',Desc1);
	 })


	$('.checkbox span').on('tap',function(){
		$('.checkbox span').removeClass('selected');
		$(this).addClass('selected');
		var value=$(this).html();
		if (value == "商家") {
		  $("#hide").val(1)
		}else{
		  $("#hide").val(0)
 		}
	})

	var flag=false;
		$('.my').on('tap',function(){
			if(flag){
				$(this).addClass('select');
				$('#wantbuy_price').attr('disabled','disabled');
				$('#wantbuy_price').val("");
			}else{
				$(this).removeClass('select');
				$('#wantbuy_price').removeAttr('disabled');
			}
			flag=!flag;
		})

		var flag1=true;
		$('.ty').on('tap',function(){
			if(flag1){
				$(this).addClass('select');
			}else{
				$(this).removeClass('select');
			}
			flag1=!flag1;
		})
	
	</script>
</body>
</html>