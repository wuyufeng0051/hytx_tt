<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>头条详情</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/base.css?v=5">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/mui.min.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/swiper.min.css">
	<script type="text/javascript" src="__PUBLIC__/Home/js/touchScale.js"></script>
	<script type="text/javascript" src="__PUBLIC__/Home/js/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/Home/js/pinchzoom.js"></script>

	<style>
	body,.mui-content{
		background: #fff;
		margin-top: .9rem;
	}
	.article{
		padding: 10px;
	}
	.article .title{
		font-size: 16px;
		border-bottom: 1px solid #ddd;
		padding-bottom: 25px;
	}
	.article .title span{
		font-size: 14px;
		color: #999;
	}
	.article .title span:last-child{
		float: right;
	}
	.article .content{
		padding-top: 10px;
		font-size: 14px;
		color: #333;
	}
	.article .content ul{

	}
	.ad img{
		width: 100%;
		display: block;
	}
	.hot {
	    font-size: 15px;
	    color: #000;
	    padding-left: 15px;
	    font-weight: inherit;
	    line-height: 32px;
	    border-bottom: 1px solid #e6e6e6;
	    margin: 0;
	    padding-top: 5px;
	}
	.no-comment{
		text-align: center;
		/*display: none;*/
		margin-bottom: 55px;
	}
	.no-comment img{
		margin-top: 20px;
		margin-bottom: 20px;
	}
	#footer{
		background: #fff;
	}
	#footer .input{
		/*margin-right: 65px;*/
	}
	#footer button{
		position: absolute;
		right: 5px;
		top: 5px;
		color: #fff;
		height: 35px;
	}
	#footer input{
		height: 35px;
		margin-top:5px;
		border:none;
		border-bottom: 1px solid #ddd;
		padding-left: 0;
	}
	#footer textarea{
		height: 40px;
		margin-top:5px;
		border:none;
		border-bottom: 1px solid #ddd;
		padding-left: 0;
		padding-top: 0px;
		/*max-height: 60px;*/ 
		margin-bottom: 3px;
	}
	.avatar{
		width: 42px;
		height: 42px;
		float: left;
		overflow: hidden;
		border-radius: 50%;
	}
	.avatar img{
		width: 100%;
		height: 100%;
		display: block;
	}
	.uname{
		margin-left: 50px;
		height: 42px;
		font-size: 16px;
		position: relative;
		color: #666;
	}
	.uname .UeserId{
		float: left;
		text-overflow: ellipsis;
		white-space: nowrap;
		overflow: hidden;
		width: 90%;
	}
	.zan{
	    padding-right: 20px;
	    background: url(/Public/Home/img/zan.png) no-repeat right 2px;
	    background-size: 16px;
	    position: absolute;
	    right: 0;
	    top: 24px;
	    color: #999;
	}
	.mui-card{
		box-shadow: none;
	}
	.swiper-container img{
		display: block;
		width: 100%;
	}
	.swiper-container-horizontal>.swiper-pagination-bullets, .swiper-pagination-custom, .swiper-pagination-fraction {
	    bottom: 0px;
	}
	.swiper-pagination-bullet-active{
		background: #ff7300;
	}
	.mui-ellipsis-1{
		display: -webkit-box;
	    overflow: hidden;
	    white-space: normal!important;
	    text-overflow: ellipsis;
	    word-wrap: break-word;
	    -webkit-line-clamp: 1;
	    -webkit-box-orient: vertical;
	    width: 40%;
	    height: 21px;
	    line-height: 21px;
	    float: left;
	}

	body{position: relative;height: 100%;}

	/*公用头部*/
	.header{
	    
	}
	.header a{
		display: inline-block;
		color: #fff;
	}
	.header .back{
	    height: .9rem;
	    line-height: .9rem;
	    width: 17%;
	    float: left;
	}
	.header .back i{
	    width: 0.4rem;
	    height: .9rem;
	    display: inline-block;
	    background: url(__PUBLIC__/Home/img/back.png) no-repeat 4px 10px;
	    vertical-align: middle;
	    background-size: .3rem;
	}
	.header .header_right{
		float: right;
		height: .9rem;
		margin-right: .2rem;
	}
	.header .header_right i{
	    width: 0.04rem;
	    height: 0.5rem;
	    display: inline-block;
	    vertical-align: middle;
	    background: #fff;
	    margin: 0 .15rem;
	}
	.header .title{
	    float: left;
	    width: 70%;
	    text-align: center;
	    font-size: 0.38rem;
	}
	.header .share_1{
	    height: .9rem;
	    float: right;
	    width: 12%;
	    background: url(__PUBLIC__/Home/img/pb_11.png) no-repeat center;
	    background-size: .5rem;
	}
	.share_box {
		display: block;
		background: url(__PUBLIC__/Home/img/share.png) no-repeat 60px -20px;
		background-size: 6rem;
		position: fixed;
		top: 2%;
		left: 0;
		right: 0;
		bottom: 0;
		z-index: 12;
		display: none;
	}
	.disk{
		background: #000;
		opacity: .5!important;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		z-index: 11 ;
		display: none;
	}
	.mui-bar.add{
		background: #f8f8f8!important;
		padding: 10px;
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		z-index: 12;
		height: auto!important;
	}
	.mui-bar.add .mui-btn{
		display: none;
	}
	.mui-bar.add .input{
		margin: 0!important;
	}
	.mui-bar.add textarea{
		height: 100px!important;
		background: #fff!important;
		position: relative!important;
		width: 100%!important;
		border: 1px solid #dedede!important;
		margin-bottom: 10px!important;
		padding: 10px!important;
		line-height: 1!important;
		opacity: 1!important;
	}
	.mui-bar .con_btn{
		display: none;
	}
	.mui-bar.add .con_btn{
		display: block;
	}
	.add .con_btn .biao{
	    float: right;
	    width: 65px;
	    height: 35px;
	    line-height: 35px;
	    text-align: center;
	    background: #fd5530;
	    color: #fff;
	}
	.mui-bar.add .cancle{
	    float: right;
	    width: 65px;
	    height: 35px;
	    line-height: 35px;
	    text-align: center;
	    background: #f8f8f8;
	    border: 1px solid #ddd;
	    color: #000;
	    margin-right: 10px;
	}
	.xiao_box{
		position: relative;
	}
	.xiao_box .xiao_img{
		float: right;
		/*margin-right: 21px;*/
	}
	.xiao_box .xiao_img img{
		width: 30px;
		height: 30px;
	}
	.xiao_box .xiao_hide_box{
		position: absolute;
		right: 32px;
		top: -2px;
	    background: url(/Public/Home/img/222.png) no-repeat center;
	    background-size: 170px;
	    width: 173px;
	    height: 35px;
	    display: none;
	    margin-right: 4px;
	}
	.xiao_box .xiao_hide_box ul li{
		float: left;
		color: #fff;
		line-height: 35px;
		text-align: center;
		width: 50%;
	}
	.xiao_box .xiao_hide_box ul li a{
		border: none;
	}
	</style>
</head>
<body>
<input type="hidden" id="Share_title" value = {$toplineDtl.topline_title}>
<include file="Public/share" title='包含文件'/>
	<!-- 共同顶部 s-->
	<div class="header fn-clear" style="height: .9rem;background: #fd5530 !important;color: #fff;font-size: .32rem;line-height: .9rem;max-width: 1080px;position: fixed;top:0;left:0;right:0;overflow: hidden;z-index: 10;">
		<div class="back"><a class="a" href="javascript:history.go(-1)"><i></i>返回</a></div>
		<div class="share_1"></div>
	</div>
	<!-- 共同顶部 e-->
	<!-- 微信分享弹出层 s -->
	<div class="share_box"></div>
	<!-- 微信分享弹出层 e -->
	<!-- 遮罩层 s -->
	<div class="disk"></div>
	<!-- 遮罩层 e -->
	<div class="mui-content">
 		<div class="article">
			<div class="title">
				<h4 style="line-height:1.5;">{$toplineDtl.topline_title}</h4>
				<span style="margin-right: 10px;float: left;">{$toplineDtl.topline_date}</span><span class="mui-ellipsis-1">来自:{$toplineDtl.topline_from}</span><span style="float: 
				right;">{$toplineDtl.topline_look}次浏览</span>
			</div>
			<div class="content" id="gallery">
				{$toplineDtl.topline_desc}
			</div>
		</div>
		<?php if (!empty($status)) { ?>
	 		<div class="ad" style="overflow: hidden;">
	 			 <div class="swiper-container">
	 			 	<div class="swiper-wrapper">
        			<volist name="status" id="vo">
            			<div class="swiper-slide">
              				 <a id="up" onclick="look(this)" str="{$vo['advertisement_id']}" stb="{$vo['advertisement_type']}" url="{$vo['advertisement_url']}">
 				 			 <img src="__PUBLIC__/../{$vo['advertisement_img']}" style="width: 100%;display: block;">
			  			 </a>
		    			</div>
	    		    </volist>
			        </div>
			        <div class="swiper-pagination"></div>
			     </div>
			</div>
        <?php } ?>

		<h5 class="hot">最新评论(<span id="newcomms">
		<?php if($comment_count < 5){ ?>
		{$comment_count}
		<?php }else{ ?>
		 5
		<?php } ?>
		</span>)
		</h5>
		<div class="comment">
			<!-- 暂无评论的时候  -->
			<div id="commentall">
			<!-- 列表 -->
			<volist id="v" name="commentAndReply">
				<div class="mui-card" style="margin:0;border-bottom: 1px solid #e6e6e6;">
					<div class="mui-card-content">
						<div class="mui-card-content-inner" style="margin:0;border-bottom: 1px solid #e6e6e6;">
							<a class="avatar">
								<img src="{$v.comment_userhead}" alt="">
							</a>
							<div class="uname">
								<em style="color: #306dd8;">{$v.comment_username}</em>
								<p style="margin:0;">{$v.comment_date|substr=5,5}</p>
								<span class="zan" str="{$v.comment_id}" id="zan">{$v.comment_like}</span>
							</div>
							<div style="padding-left: 50px;position: relative;margin-top:10px" class="text" >
							  {$v.comment_content}
							</div>
							<div class="xiao_box fn-clear">
								<div class="xiao_img"><img src="__PUBLIC__/Home/img/211.png" alt=""></div>
								<div class="xiao_hide_box fn-clear">
									<ul>
									<?php if ($v['comment_uid'] == $_SESSION['user_id']) { ?>
										<li><a style="display: inline-block;width: 100%;color: #fff;" id="del" class="d{$v.comment_id}" str="{$v.comment_id}">删除</a></li>
		 							<?php }else{ ?>
										<li><a href="__MODULE__/Index/reportComment?comment_id={$vo.comment_id}" style="display: inline-block;width: 100%;color: #fff;">举报</a></li>
									<?php } ?>
										<li><a href="__MODULE__/TopLine/topcomment?comment_id={$v.comment_id}" style="display: inline-block;width: 100%;color: #fff;">回复</a></li>
									</ul>
								</div>
							</div>
							<div class="repeat"></div>
	 				  </div>
	 				  <volist name="v.reply" id="vo">
						  <div class="mui-card" style="margin:0;background: #f5f5f5;border-bottom: 1px solid #e7e7e7">
							<div class="mui-card-content">
								<div class="mui-card-content-inner" >
									<a class="avatar">
										<img src="{$vo.comment_userhead}" alt="">
									</a>
									<div class="uname fn-clear">
										<div class="UeserId">
											<span class="showff" style="color: #306dd8;">{$vo.comment_username}</span>
											<span style="margin:0 5px;color: #333;">回复</span>
											<span class="showff" style="color: #306dd8;">{$vo.comment_isusername}</span>
										</div>
										<p style="margin:0; float: left;width: 100%;">{$vo.comment_date|substr=5,5}</p>
										<input type="hidden" value="{$vo.comment_id}">
										 <span class="zan" id="zan" str="{$vo.comment_id}">{$vo.comment_like}</span>
									</div>
									<div style="margin-left: 50px;margin-top: 10px;">
										{$vo.comment_content}
		 							</div>
									<div class="xiao_box fn-clear">
										<div class="xiao_img"><img src="__PUBLIC__/Home/img/211.png" alt=""></div>
										<div class="xiao_hide_box fn-clear">
											<ul>
												<?php if ($vo['comment_uid'] == $_SESSION['user_id']) { ?>
										<li><a style="display: inline-block;width: 100%;color: #fff;" id="del"  str="{$vo.comment_id}">删除</a></li>
		 							<?php }else{ ?>
										<li><a href="__MODULE__/Index/reportComment?comment_id={$vo.comment_id}" style="display: inline-block;width: 100%;color: #fff;">举报</a></li>
									<?php } ?>
										<li><a href="__MODULE__/TopLine/topcomment?comment_id={$vo.comment_id}" style="display: inline-block;width: 100%;color: #fff;">回复</a></li>
											</ul>
										</div>
									</div>
		 						</div>
		 					</div>
						</div>
                        </volist>
					  <?php if($v['reply_count'] > 3 ){ ?>
							<div class="more" style="padding-top: 8px;padding-bottom: 8px;padding-left: 118px;background: #f5f5f5;">
								<div class="mui-ellipsis" style="width: auto;margin-right: 10px;background: #B9B9B7;color: #fff;text-align: center;border-radius: 5px;height: 30px;line-height: 30px;">
									<a href="__MODULE__/TopLine/topcomment?comment_id={$v.comment_id}" style="color: #fff;" >共<span id="msg_count">{$v.reply_count}</span>条回复，点击查看更多>></a>
								</div>
							</div>
                       <?php } ?>
					</div>
				</div>
 			 </volist>
 			</div>
			<?php if($comment_count != 0){ ?>
			<?php if($comment_count > 5){ ?>
			<div class="more" style="margin-bottom: 70px;">
				<div class="mui-ellipsis" style="margin: 12px auto;width: 70%;background: #969593;color: #fff;text-align: center;border-radius: 5px;height: 30px;line-height: 30px;font-size: 14px;">
					<a href="__MODULE__/TopLine/topall?topline_id={$v.comment_toplineid}" str="{$vo.comment_id}" style="color: #fff;">共{$comment_count}条评论，点击查看更多评论>></a>
				</div>
			</div>
			<?php }else{ ?>
			<div class="more" style="height:50px;">
			<?php } ?>
			<?php }else{ ?>
			<div class="no-comment">
				<img src="__PUBLIC__/Home/img/pen.png" alt="">
				<p style="color: #bfbfbf;font-size: 18px;">暂无评论，快留下你的牛评！</p>
			</div>
			<div class="more" style="height:30px;">
			</div>
		<?php } ?>
		</div>
 	</div>
	<footer class="mui-bar mui-bar-footer" id="footer" style="height: 55px;">
		<div style="padding: 0 10px;">
			<div class="input">
				<textarea style="z-index: 999;position: relative;opacity: 0;width: 100%;"  name="" id="comm" cols="30" rows="10" placeholder="说两句再走吧··· 80个字以内"></textarea>
				<span style="position: absolute;left: 10px;top:0px;width: 75%;background: #e6e6e6;color: #71706f;height: 35px;border-radius: 5px;margin-top: 10px;font-size: 16px;padding: 0;padding-left: 10px;line-height: 35px;overflow: hidden;">说两句再走吧··· 80个字以内</span>
				<div class="con_btn fn-clear"><div class="biao" id='hf'>发表</div><div class="cancle">取消</div></div>
			</div>
			<button type="button" class="mui-btn" style="background: url(__PUBLIC__/Home/img/pinglun_1.png) no-repeat left;padding-left: 24px;border:none;background-size: 20px;color: #fd5530 !important;font-size: 16px;margin-top: 3px;" >评论</button>
		</div>
	</footer>
	<script src="__PUBLIC__/Home/js/mui.min.js"></script>
	<script src="__PUBLIC__/Home/js/zepto.min.js"></script>
	<script src="__PUBLIC__/Home/js/jquery.min.js"></script>
	<script src="__PUBLIC__/Home/js/layer.js"></script>
	<script src="__PUBLIC__/Home/js/swiper.min.js"></script>
	<script>
		$('.comment').delegate('#del','click',function(){
			var comment_id = $(this).attr('str');
			  var thiss=$(this);
			 if(confirm("确定删除？")){
			   $.post('{:U("Home/TopLine/delcomm")}',{comment_id:comment_id}, function(data) {
				   if (data == 1) {
					   thiss.closest('.mui-card-content').remove();
					   thiss.closest('.mui-card').remove();
					   var msgcount=parseInt($("#msg_count").text())-1;
					   var newcomms = parseInt($("#newcomms").text())-1;
					   $("#newcomms").text(newcomms);
                       $("#msg_count").text(msgcount);
                       layer.msg('删除成功', {
                           time: 1000 //2秒关闭（如果不配置，默认是3秒）
                       }, function(){
                           window.location.reload();
                       });
				   }else{
					layer.msg('系统繁忙中，请稍后再试');
				   }
			   });
			 }
		})
     //回复
     $('#hf').click(function(){
         var topline_id ='{$toplineDtl.topline_id}';
         var comm = $("#comm").val();
         if (!comm) {
             layer.msg('请先输入内容')
         }else{
             $.post('{:U("Home/TopLine/addTopLineComment")}',{topline_id:topline_id,comm:comm}, function(data) {
                 if(data == 1){
                     layer.msg('评论已发表 审核中')
                 }else if(data != 3){
                     //添加评论的条数
                     $(".no-comment").hide();
                     $(".more").css('height','54px');
                     var newcomms = parseInt($("#newcomms").text())+1;
                     $("#newcomms").text(newcomms)
                     //如果评论小于5条就在当前页面添加评论
                     if (newcomms < 6) {
                         strs=data.split(","); //字符分割
                         $('#commentall').prepend('<div class="mui-card" style="margin:0;border-bottom: 1px solid #e6e6e6;">'
                             +	'<div class="mui-card-content">'
                             +		'<div class="mui-card-content-inner">'
                             +			'<a class="avatar">'
                             +				'<img src="'+strs[1]+'" alt="">'
                             +			'</a>'
                             +			'<div class="uname">'
                             +				'<em style="color: #306dd8;">'+strs[0]+'</em>'
                             +				'<p style="margin:0;">'+strs[2]+'</p>'
                             +				'<span id="zan"  class="zan" str="'+strs[3]+'">0</span>'
                             +			'</div>'
                             +			'<div style="padding-left: 50px;position: relative;" class="text">'
                             +			  comm
                             +			'</div>'
                             +			'<div class="xiao_box fn-clear">'
                             +			'<div class="xiao_img"><img src="__PUBLIC__/Home/img/211.png" alt=""></div>'
                             +			'<div class="xiao_hide_box fn-clear">'
                             +			'<ul>'
                             +			'<li id="del" class="d'+strs[3]+'" str="'+strs[3]+'">删除</li>'
                             +			'<li><a href="__MODULE__/TopLine/topcomment?comment_id='+strs[3]+'" style="display: inline-block;width: 100%;color: #fff;">回复</li>'
                             +			'</ul>'
                             +			'</div>'
                             +		'</div>'
                             +			'<div style="padding-left: 50px;">'
                             +			'</div>'
                             +		'</div>'
                             +	'</div>'
                             +'</div>')
                         layer.msg('发表成功', {
                             time: 1000 //2秒关闭（如果不配置，默认是3秒）
                         }, function(){
                             window.location.reload();
                         });
                         zan();
                     }else{
                         layer.msg('发表成功')
                         function code(){

                             location.href="__MODULE__/TopLine/topall?topline_id="+topline_id
                         }

                         setTimeout(code(),2000)
                     }
                 }else{
                     layer.msg('系统繁忙,请稍后再试')
                 }
                 $("#comm").val("");
             });
         }
     })

     zan()
     function zan(){
         //点赞
		 $('.comment').delegate('#zan','click',function(){
			 var thiss =$(this).parent().parent().parent().find('.zan')
			 var like = $(this).parent().parent().parent().find('.zan').text();
			 var comment_id = $(this).attr('str');

			 //获取评论的id
			 $.post('{:U("Home/TopLine/addTopLineLike")}',{comment_id:comment_id}, function(data) {
				 if (data == 1) {
					 //加评论的条数
					 var likenum = parseInt(like)+1;
					 thiss.text(likenum)
				 }else if(data == 2){
					 layer.msg('系统繁忙中，请稍后再试')
				 }else{
					 layer.msg('您已点赞过')
				 }
			 });
		 })
     }
     function look(obj){
         //  $("[id=up]").each(function(){
         // $(this).click(function(){
         var id = $(obj).attr('str');
         var type = $(obj).attr('stb');
         var url = $(obj).attr('url');
         $.post('{:U("Home/Index/addTraffic")}', {id:id}, function(data) {
             if (type == 0) {
                 location.href="http://"+url;
             }else if(type == 1){
                 location.href= 'tel:' + url;
             }else{
                 location.href=url;
             }
         });
         // 	})
         // })
     }
     var mySwiper = new Swiper('.swiper-container',{
		    pagination: '.swiper-pagination',
		    loop:true,
		    paginationClickable: true,
		    autoplayDisableOnInteraction : false,
		    autoHeight: true,
		    autoplay: 3000
		});
	var u = navigator.userAgent;
	var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
	var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
	if(isiOS == true){
		// $('#footer').css({'width': '100%','height': '55px','text-align': 'center';'position': 'absolute', 'bottom': '0','left': '0'});
		// $('.mui-content').css({'height': '100%','overflow': 'auto','padding-bottom': '80px';});
		$('#footer .input textarea').focus(function(){
			$('.mui-bar').addClass('add');
			$('.disk').show();
			$('#footer').css({'position':'absolute','bottom':'62px','left':'0'});
			$('.input span').hide();
		});
		$('#footer .input textarea').blur(function(){
			$('#footer').css({'position':'fixed','bottom':'0','left':'0'});
		});
	}else{
		$('#footer .input textarea').focus(function(){
			$('.mui-bar').addClass('add');
			$('.disk').show();
			$('#footer').css({'position':'absolute','bottom':'-5px;','left':'0'});
			$('.input span').hide();
		});
		$('#footer .input textarea').blur(function(){
			$('#footer').css({'position':'fixed','bottom':'0','left':'0'});
		});
	}

	// 分享引导弹出层
	$('.share_1').click(function(){
		$('.share_box').show();
		$('.disk').show();
	})
	$('.share_box').click(function(){
		$('.share_box').hide();
		$('.disk').hide();
	})
	$('.biao').click(function(){
		$('.mui-bar').removeClass('add');
		$('.disk').hide();
		$('.input span').show();
	})
	$('.cancle').click(function(){
		$('.mui-bar').removeClass('add');
		$('.disk').hide();
		$('.input span').show();
	})
	$('.disk').click(function(){
		$('.mui-bar').removeClass('add');
		$('.disk').hide();
		$('.input span').show();

	})
	$('.comment').delegate('.xiao_img','click',function(){
		var x = $(this),
			find = x.closest('.xiao_box').find('.xiao_hide_box');
		if (find.css("display") == "none") {
			find.show();
		}else{
			find.hide();
		}
		return false
	})
	$('body').click(function(){
		var x = $('.xiao_hide_box');
		x.hide();
	})

	var imgsObj = $('#gallery img');    
    var imgs = new Array();    
    for(var i = 0; i < imgsObj.size(); i++){    
        imgs.push("http://116.62.45.62"+imgsObj.eq(i).attr('src')+"");    
    }    
        
    $('#gallery img').on('click',function(){  

        wx.previewImage({
		    current: "http://116.62.45.62"+ $(this).attr('src') +"" , // 当前显示图片的http链接
		    urls: imgs  // 需要预览的图片http链接列表
		}); 
    }); 
  
	$('#pinch').each(function () {
        new RTP.PinchZoom($(this), {});
    });

	</script>
</body>
</html>