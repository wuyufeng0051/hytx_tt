<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>求购求租</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/mui.min.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/swiper.min.css">
	<style>
	body{
		padding-top: 95px;
	}
	.searchBar{
		width: 100%;
		height: 50px;
		position: fixed;
		top:0;
		background: #fd5530;
		z-index: 100;
	}
	.search{
		position: relative;
		padding: 7px 10px;
		padding-right: 95px;
	}
	.searchBar input{
		margin: 0;
		height: 36px;
		line-height: 36px;
		border:none;
		font-size: 14px;
		color: #fff;
		padding-left: 30px;
		background: #ff7558 url(__PUBLIC__/Home/img/search.png) no-repeat 10px center;
		background-size: 16px 16px;
		text-align: left;
	}
	::-webkit-input-placeholder { 
	    color:#fff;
	}
	.searchBar .search-r{
		position: absolute;
		right: 5px;
		top:15px;
		font-size: 14px;
		color: #fff;
	}
	.searchBar .search-r a{
		padding: 0 8px;
		border-right: 1px solid #fff;
		color:#fff;
	}
	.searchBar .search-r a:last-child{
		border:none;
	}

	.mui-popover-arrow{
	    display: none;
	}
	.mui-popover{
	    position: fixed;
	    width: 80%;
	    border-radius: 10px;
	    left: 50%;
	    top: 50%;
	    margin: 0 auto;
	    z-index: 9999;
	    background-color: #fff;
	    -webkit-transform: translateX(-50%) translateY(-50%);
	    -moz-transform: translateX(-50%) translateY(-50%);
	    -ms-transform: translateX(-50%) translateY(-50%);
	    transform: translateX(-50%) translateY(-50%);
	    overflow: hidden;
	}
	.mui-popover h4{
		background-color: #ff7400;
		color: #fff;
		text-align: center;
		padding:10px 0;
		margin:0;
		font-weight: normal;
		text-indent: 5%;
	}
	.mui-popover h4 span{
		width: 20px;
		height: 20px;
		display: inline-block;
		font-weight: normal;
		font-size: 25px;
		line-height: 20px;
		float: right;
		margin-right: 10%;
		position: relative;
	}
	.mui-popover ul{
		padding:0;
		margin:0;
	}
	.mui-popover ul li{
		line-height: 40px;
		text-align: center;
		border-bottom: 1px solid #e6e6e6;
	}
	.mui-popover ul li a{
		color:#000;
	}

	/*筛选*/
	.bg{
		position: fixed;
		top: 0px;
		left: 0px;
		width: 100%;
		height: 100%;
		background: #000000;
		opacity: 0.5;
		z-index: 1;
		display: none;
	}
	.nav{
		width: 100%;
		position:fixed;
		top: 50px;
		z-index: 99999;
	    background: #fff;
	    border-bottom: 1px solid #EAEAEA;
	    z-index: 10;
	}
	.nav .nav_ul{
		list-style: none;
		padding: 0px;
		margin: 0px;
		position: relative;
		width: 100%;
		float: left;
	}
	.nav .nav_ul li.nav_ul_li{
		float: left;
		width: 50%;
	}
	.nav .nav_ul li.nav_ul_li h1{
		float: left;
		width: 100%;
		padding:10px 0px;
		text-align: center;
		color: #333;;
		font-size: 14px;
		font-weight: normal;
		cursor: pointer;
		padding-top: 2px;
	}
	.nav .mui-icon{
		font-size: 14px;
	}
	.nav_child{
		list-style: none;
		padding: 0px;
		margin: 0px;
		display: none;
		float: left;
		width: 100%;
		position:absolute;
		left: 0px;
		top: 46px;
		z-index:99999;
		background: #fff;
	}
	.nav_child li{
		float: left;
		width: 100%;
		border-top: 1px solid #EAEAEA;
	}
	.nav_child li a{
		float: left;
		width: 100%;
		padding:10px 0px;
		text-align:left;
		text-indent: 15px;
		font-family: "微软雅黑";
		color: #000;
		font-size: 12px;
		font-weight: normal;
		cursor: pointer;
	}

	.nav_child li a .mui-icon{
		font-size: 18px;
		display: none;
		color: #ccc;
		float: right;
	}

	/*轮播*/
	.swiper-container img{
		display: block;
		width: 100%;
	}
	.swiper-container-horizontal>.swiper-pagination-bullets, .swiper-pagination-custom, .swiper-pagination-fraction {
	    bottom: 0px;
	}
	.swiper-pagination-bullet-active{
		background: #ff7300;
	}

	.mui-card{
		box-shadow: none;
	}
	.backTop {
	    border-radius: 50%;
	    position: fixed;
	    right: 10px;
	    bottom: 15px;
	    width: 40px;
	    height: 40px;
	    text-align: center;
	    font-size: 18px;
	    color: #666666;
	    padding-top: 8px;
	    border:2px solid #707070;
	    background: #fff url(__PUBLIC__/Home/img/toTop.png) center center no-repeat;
	    background-size: 20px 20px;
	}
	.mui-table-view-cell{
		padding-left: 3%;
		padding-right: 3%;	
		position: static;
	}
	.mui-table-view-cell.mui-active{
		background-color: #0062cc;
	}
	.mui-ellipsis-1{
		display: -webkit-box;
	    overflow: hidden;
	    white-space: normal!important;
	    text-overflow: ellipsis;
	    word-wrap: break-word;
	    -webkit-line-clamp: 1;
	    -webkit-box-orient: vertical;
	    height: 35px;
	    line-height: 35px;
	}
	.nav_ul_li ul{
		max-height: 265px;
		overflow-y:scroll;
		border-bottom: 0;
	}
	.mui-table-view:after{
		height: 0;
	}
	.mui-table-view-cell:after{
		height: 0;
	}
	body{position: relative;}
	</style>
</head>
<body>

<include file="Public/share" title='包含文件'/>

	<div class="mui-content">
	<form action="javascript:return true;">
		<div class="searchBar">
			<div class="search">
				<?php if(!empty($_GET)){ ?>
			    <div style="overflow: hidden;height: 36px;color:#fff;line-height: 40px;">
 					  <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#fff;line-height: 35px;">
 					  </a>
 					  &nbsp;搜索结果
 				</div>
			   <?php }else{ ?>
				<div class="search-l">
					<input type="search" placeholder="搜索关键词" id="search" style="padding-left:30px;">
				</div>
			   <?php } ?>
				<div class="search-r">
					<a id="fabu">发布</a><a href="__MODULE__/My/myRelease" style="color:#fff;">我的</a>	
				</div>
			</div>
		</div>
	</form>
 

<?php if(!empty($status)){ ?>
	<div class="swiper-container">
		<div class="swiper-wrapper">
		 <volist name="status" id="vo"> 
			<div class="swiper-slide">
				<a id="up" onclick="look(this)" str="{$vo['advertisement_id']}" stb="{$vo['advertisement_type']}" url="{$vo['advertisement_url']}">
 				  <img src="__PUBLIC__/../{$vo['advertisement_img']}">
			   </a>
			</div>
		 </volist>
		</div>
		<div class="swiper-pagination"></div>
	</div>
<?php } ?>
	<div class="bg"></div>
	<div class="nav">
			<ul class="nav_ul">
				<li class="nav_ul_li">
					<h1 class="mui-ellipsis-1"><span id="num">类型</span><span class="mui-icon mui-icon-arrowdown"></span></h1>
					<ul class="mui-table-view nav_child" id="wanted_class">
						<li id="chance" strong="1" class="mui-table-view-cell"><a>不限</a></li>
					 <volist name="class_query" id="vo">
						<li id="chance" strong="{$vo.classify2_id}" class="mui-table-view-cell"><a>{$vo.classify2_name}</a></li>
					 </volist>
 					</ul>
				</li>
				<li class="nav_ul_li">
					<h1 class="mui-ellipsis-1"><span id="num">需求</span><span class="mui-icon mui-icon-arrowdown"></span></h1>
					<ul class="mui-table-view nav_child" id="wanted_type">
						<volist name="type_query" id="vo">
						<li id="chance" strong="{$vo.query_val}" class="mui-table-view-cell"><a>{$vo.query_name}</a></li>
					 </volist>
 					</ul>
				</li>
				
			</ul>
		</div>	

<div id="zong">
    <foreach item="vo" name="wanted_res" key="k">
		<div class="mui-card" style="margin:0;border-bottom: 1px solid #ddd;">
			<div class="mui-card-content">
				<div class="mui-card-content-inner" style="padding: 10px 10px;">
				   <?php if($vo['wanted_type'] == 1){ ?>
					<a style="position: relative;padding-left: 90px;display: block;color:#000;height: 65px;"  stv="{$vo.wanted_id}" class="topheight" str="wantedRent">
						<img src="__PUBLIC__/Home/img/qz.png" alt="" style="position: absolute;left: 0;right: 0;width: 85px;height: 65px;">
						<div class="mui-ellipsis-2" style="height: 42px;">
							{$vo.wanted_title}
						</div>
						<p style="margin-bottom: 0;margin-top:5px;font-size: 12px;">
						<span style="color: #ff7300;font-size: 16px;">
                        	<?php if($vo['wanted_price'] == 0){ ?>
							面议
							<?php }else{ ?>
							{$vo.wanted_price}
							{$vo.wanted_pricetype}
							<?php } ?>
						</span>
						&nbsp;&nbsp;{$vo.wanted_class}&nbsp;&nbsp;
						<?php if($vo['wanted_is_top'] == 1 ){ ?>
						<span style="float: right;">置顶</span></p>
						<?php }else{ ?>
						<span style="float: right;" class="time">{$vo.wanted_date}</span></p>
						<input type="hidden" value="{$vo.wanted_date}" class="times">
						<?php } ?>
					</a>
				   <?php }else{ ?>
				   <!-- href="__MODULE__/Wanted/wantedBuyDetails?wanted_id={$vo.wanted_id}"  -->
				   <a style="position: relative;padding-left: 90px;display: block;color:#000;height: 65px;"  stv="{$vo.wanted_id}" class="topheight" str="wantedBuy">
						<img src="__PUBLIC__/Home/img/qg.png" alt="" style="position: absolute;left: 0;right: 0;width: 85px;height: 65px;">
						<div class="mui-ellipsis-2" style="height: 42px;">
							{$vo.wanted_title}
						</div>
						<p style="margin-bottom: 0;margin-top:5px;font-size: 12px;">
						<span style="color: #ff7300;font-size: 16px;">
						    <?php if($vo['wanted_price'] == 0){ ?>
							面议
							<?php }else{ ?>
							{$vo.wanted_price}
							{$vo.wanted_pricetype}
							<?php } ?>
					    </span>
						&nbsp;&nbsp;{$vo.wanted_class}&nbsp;&nbsp;
						<?php if($vo['wanted_is_top'] == 1 ){ ?>
						<span style="float: right;">置顶</span></p>
						<?php }else{ ?>
						<span style="float: right;" class="time">{$vo.wanted_date}</span></p>
						<input type="hidden" class="times" value="{$vo.wanted_date}">
						<!-- {$vo.wanted_date} -->
						<?php } ?> 
					</a>
				   <?php } ?>
				</div>
			</div>
		</div>
    </foreach>
</div>
	</div>

	<a id="scrollToTop" class="backTop"></a>
	<div id="pop" class="mui-popover">
		<h4>请选择您要发布的类别<span class="mui-icon mui-icon-close"></span></h4>
		<ul class="mui-table-view">
			<li class="mui-table-view-cell" style="padding:5px 0;"><a href="__MODULE__/Wanted/wantedBuyRelease">求购</a></li>
			<li class="mui-table-view-cell" style="padding:5px 0;"><a href="__MODULE__/Wanted/wantedRentRelease">求租</a></li>
		</ul>
    </div>

 
     <div style="width:30%;margin:0 auto;color:#000;padding:5px;font-size:12px;color:#888;" id="load" srv="0">
        往上滑加载更多
    </div>
    
    <input type="hidden" id="limit" value="0">
    <input type="hidden" id="scrollTop" value="0">
    <input type="hidden" id="is_look">


	<script src="__PUBLIC__/Home/js/mui.min.js"></script>
	<script src="__PUBLIC__/Home/js/zepto.min.js"></script>
	<script src="__PUBLIC__/Home/js/jquery.min.js"></script>
	<script src="__PUBLIC__/Home/js/swiper.min.js"></script>
	<script src="__PUBLIC__/Home/js/layer.js"></script>
	<script src="__PUBLIC__/Home/js/time.js"></script>

	<script>
	  function muicard(){
    	var all = 0;
    	var have = $('.mui-card')
    	$.each(have,function(index,item){
               all += 1; 
    	})
 
    	if (all < 10) {
    		$('#load').hide(); 
    	}else{
    		$('#load').show(); 
    	}
    }

   muicard();


    function toploa(){
	   $('.topheight').on('click', function() {
	      var stv = $(this).attr('stv');
	      var str = $(this).attr('str');
	      var scrollTop =getScrollTop();
		      $("#scrollTop").val(scrollTop);
		      var zong =$("#zong").html();

			// alert(str)
			$.post('{:U("Home/Demo/look")}', {str:str,stv:stv}, function(daty){
				// alert(daty)
			     if (daty == 1) {
			      $.post('{:U("Home/Wanted/sessionwanted")}', {zong:zong}, function(data){
			      	if (str=="wantedRent") {
			      	   location.href="__MODULE__/Wanted/wantedRentDetails?wanted_id="+stv
 			      	}else{
 			      	   location.href="__MODULE__/Wanted/wantedBuyDetails?wanted_id="+stv; 
 			      	}
			       }); 
    	}else{
	         layer.msg('对不起,信息已删除')
	    }
	 	 })


	   });
	 }
	 toploa(); 


	   //求滚动条的高度
	   function getScrollTop(){
		    var scrollTop=0;    
		    if(document.documentElement&&document.documentElement.scrollTop){    
		        scrollTop=document.documentElement.scrollTop;    
		    }else if(document.body){    
		        scrollTop=document.body.scrollTop;    
		    }    
		    return scrollTop;    
		} 

	   //如果之前滚动条的位置
	    function time(){
	        muicard();
 	      var is_look = $("#is_look").val();
	      if (is_look) {
		  	  $("#load").hide();
		    }
	      var limit = $("#limit").val();
	 	  // if (limit != 0) {
	 	  	$.post('{:U("Home/Wanted/looksessionwanted")}', {limit:limit},function(data){
	 	  // 			var scrollTop = $("#scrollTop").val();
					// alert(scrollTop);
	 	  		if (data != 2) {
	   	  		   $("#zong").html("");
	  	  		   $("#zong").append(data)
	  	  		    var tab = $("#zong").text();
					if (tab) {
					var scrollTop = $("#scrollTop").val();
					 
					 window.scrollTo(0,scrollTop);
					 toploa();
					}
				}else{
				 	$('#limit').val(0)
				 	$("#scrollTop").val(0);
				 }
	 	  	});
	 	  // }
	    }
	  setTimeout(time(),1000);

       	//加载
	  function loadclick(){
		$(window).scroll(function(){
			var if_get ='<?php echo $_GET["worder"] ; ?>'
 			if (if_get) {
  			  //判断是否是get
             var ms = 1;
 		    }else{
             var ms = 0;
 		     }
			var is_look = $('#is_look').val();
		　　var scrollTop = $(this).scrollTop();
		　　var scrollHeight = $(document).height();
		　　var windowHeight = $(this).height();
		　　if(scrollTop + windowHeight == scrollHeight){
 		    	var limit = parseInt($('#limit').val())+1;
 		    	  $('#limit').val(limit);
 		    	  $("#load").show();
 		    	 setTimeout(function(){
					if (is_look) {
						   //判断是否是查询
					     	$.post('{:U("Home/wanted/lookWanted")}',{limit:limit,arryall:is_look},function(data){
							if (data == 0) {
							 $("#load").text('已经到底了！')	
							}else{
							 $("#zong").append(data)
							  toploa(); 
							}
	  					  
	   				      })
					}else{
						$.post('{:U("Home/wanted/loadwanted")}',{ms:ms,limit:limit},function(data){
							if (data == 0) {
							 $("#load").text('已经到底了！')	
							}else{
							 $("#zong").append(data)
							  toploa(); 
							}
	  					  
	   				   }) 
  		　　      }
				  timeStamp()
			     },500);
  		   
  		  }
		});
	}	
   
    loadclick()
    
 function look(obj){
	 // $("[id=up]").each(function(){ 
		// $(this).click(function(){
     		var id = $(obj).attr('str');
     		var type = $(obj).attr('stb');
     		var url = $(obj).attr('url');
				// alert(id)
		$.post('{:U("Home/Index/addTraffic")}', {id:id}, function(data) {
 	     		if (type == 0) {
	     			 location.href="http://"+url;
	     		}else if(type == 1){
	     			 location.href= 'tel:' + url;
	      		}else{
	      			location.href=url;
	      		}
			});
    // 	})
    // })
	}
		var mySwiper = new Swiper('.swiper-container',{
		    pagination: '.swiper-pagination',
		    loop:true,
		    paginationClickable: true,
		    autoplayDisableOnInteraction : false,
		    autoHeight: true,
		    autoplay: 3000
		});
		mui.init();
      	
        // 弹出层
      	var pop = document.getElementById("pop");
        var mask = mui.createMask(function(){
            pop.classList.remove('mui-active');
        });
        // 显示
        mui('#fabu')[0].addEventListener('click',function(){
            mask.show();//显示遮罩
            pop.classList.add('mui-active');
        })
         //按钮关闭弹出框
        $(".mui-icon-close").click(function(){
         	pop.classList.remove('mui-active');
         	mask.close();
         	
         })
        //
          $('#search').on('search', function(e){
         	//搜索关键字
         	val =  $('#search').val();
         	if (!val) {
         		layer.msg('请先输入关键字')
         	}else{
            window.location.href="__MODULE__/Wanted/wanted?worder="+val
	        }
 		});
        //
        $(document).ready(function(){
      		
     		$(".nav_ul_li h1").click(function(){
      			if($(this).parent().find(".nav_child").is(":hidden")){
      				$(".nav_ul_li h1").css("color","#333");
      				$(this).css("color","#ff7300");
      				
      				$(".nav_ul_li h1 .mui-icon").removeClass("mui-icon-arrowup");
      				$(".nav_ul_li h1 .mui-icon").addClass("mui-icon-arrowdown");
      				$(this).find(".mui-icon").removeClass("mui-icon-arrowdown");
      				$(this).find(".mui-icon").addClass("mui-icon-arrowup");
      				
      				
					$(".nav_child").hide();				
      				$(this).parent().find(".nav_child").show();
      				
      				$(".bg").show();
				}
				else{
					$(this).css("color","#333");
					
					$(this).find(".mui-icon").removeClass("mui-icon-arrowup");
      				$(this).find(".mui-icon").addClass("mui-icon-arrowdown");
					
					$(".nav_child").hide();
      				$(this).parent().find(".nav_child").hide();
      				
      				$(".bg").hide();
				}
    		})

     		//点击蒙版下拉列表隐藏
     		$(".bg").click(function(){
     			$(".nav_child").hide();
     			$(".nav_ul_li h1").css("color","#333");
     			$(".nav_ul_li h1 .mui-icon").removeClass("mui-icon-arrowup");
     			$(".nav_ul_li h1 .mui-icon").addClass("mui-icon-arrowdown");
     			$(".bg").hide();
     		})
     		/*tap事件会造成穿透*/
     		$(".nav_child a").on('click',function(){
	     			$(this).parent().parent().find(".mui-icon").hide();
	     			$(this).find(".mui-icon").show()
	     			/*隐藏遮罩层*/
	     			$('.bg').hide()
	     			$(".nav_child").hide();	
	     			$(".nav_ul_li h1").css("color","#333");
	     			$(".nav_ul_li h1 .mui-icon").removeClass("mui-icon-arrowup");
	  				$(".nav_ul_li h1 .mui-icon").addClass("mui-icon-arrowdown");
	     		});
	      	})
	        $("#scrollToTop").on("touchend", function(e) {
				e.preventDefault();	
			    mui.scrollTo(0,100);
			});



			  $('[id=chance]').each(function() {
		     	$(this).click(function(){
		     		//点击选择的值（id）
	     		var chanceclass =  $(this).attr('str');
	     		//选择的内容
	     		var chancename =  $(this).text()
	     		//修改默认的值（圈子的内容）
	     		$(this).parent().parent().find('#num').text(chancename);
	     		//添加class（圈子的id）
	     		$(this).parent().parent().find('#num').attr('class',chanceclass);
		     		//有hava表示选中的
		     	  $(this).addClass('have').siblings().removeClass('have');
		           var have=$('.have')
		           var arryall = new Array();  
					$.each(have,function(index,item){
						var haveed = $(this).attr('strong');
						var id = $(this).parent().parent().find('.nav_child').attr('id');
						//判读有无值
		 				 arryall[index]=id+"="+haveed;
		 			})
                    $("#is_look").val(arryall)
		 			//查
		 			 $("#zong").empty();
 			        $("#limit").val(0)
 			         $("#load").text('往上滑加载更多')

		 			 $.post('{:U("Home/Wanted/lookWanted")}',{arryall:arryall},function(data){
                          	$('#zong').append(data)
                          	  timeStamp()
					          toploa()
				              muicard();
                         
                     })
                  })
		     })
     

       function timeStamp(){
		var time=$('.times')
		$.each(time,function(index,item){
		 if ($(this).val().length > 13) {
		   var timeText=$(this).val();
		   // alert(timeText);
	 	    getDateDiff(stringToTime(timeText))
		    $(this).parent().find('.time').text(getDateDiff(stringToTime(timeText)))
		  }
		 })
		}

		timeStamp()

		var u = navigator.userAgent;
		var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
		var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
		if(isiOS == true)
		{
			$('.searchBar input').focus(function(){
	         	$('.searchBar').css({'position':'absolute','top':'0','left':'0'});
	         	$('.nav').css({'position':'absolute','top':'50px','left':'0'});
         	})
           $('.searchBar input').blur(function(){
	         	$('.searchBar').css({'position':'fixed','top':'0','left':'0'});
	         	$('.nav').css({'position':'fixed','top':'50px','left':'0'});
          })
       }
	</script>
</body>
</html>